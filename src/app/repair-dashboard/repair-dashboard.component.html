<div class="row">
  <div class="col-8">
    <div class="card">
      <div class="card-body">

        <ng-container>

          <div class="row mb-3">
            <div class="col-6 input-group input-group-sm">
              <div class="input-group-prepend">
                <span class="input-group-text">Desde</span>
              </div>
              <input class="form-control" placeholder="yyyy-mm-dd"
                     name="from"
                     [maxDate]="ngbDateTo"
                     [displayMonths]="displayMonths"
                     [navigation]="navigation"
                     [outsideDays]="outsideDays"
                     [(ngModel)]="ngbDateFrom"
                     (ngModelChange)="formatDate(ngbDateFrom, 'from')"
                     ngbDatepicker
                     #from="ngbDatepicker">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" (click)="from.toggle()" type="button">📅 </button>
              </div>
            </div>

            <div class="col-6 input-group input-group-sm">
              <div class="input-group-prepend">
                <span class="input-group-text">Hasta</span>
              </div>
              <input class="form-control" placeholder="yyyy-mm-dd"
                     name="upto"
                     [minDate]="ngbDateFrom"
                     [maxDate]="ngbMaxDate"
                     [displayMonths]="displayMonths"
                     [navigation]="navigation"
                     [outsideDays]="outsideDays"
                     [(ngModel)]="ngbDateTo"
                     (ngModelChange)="formatDate(ngbDateTo, 'to')"
                     ngbDatepicker
                     #upTo="ngbDatepicker">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" (click)="upTo.toggle()" type="button">📅 </button>
              </div>
            </div>
          </div>

          <p></p>

          <div id="grid-container">
            <div class="alert alert-info h-100 text-center" *ngIf="!gridCollection"> <h3> Cargando... </h3> </div>

            <wj-flex-grid  *ngIf="gridCollection"
                           [itemsSource]="gridCollection"
                           [selectionMode]="'Row'"
                           [headersVisibility]="'Column'"
                           [autoGenerateColumns] = "false"
                           [allowResizing]="'Columns'"
                           [showSelectedHeaders]="'Row'"
                           [isReadOnly]="true"
                           (selectionChanged)="getRepairDetails(gridCollection.currentItem)">
              <wj-flex-grid-filter></wj-flex-grid-filter>
              <wj-flex-grid-column *ngFor="let column of columns"
                                   [width]="column.width"
                                   [binding]="column.binding"
                                   [header]="column.header"
                                   [visible]="true">
              </wj-flex-grid-column>
            </wj-flex-grid>
          </div>

          <p></p>

          <div id="footerControls" class="row">
            <div class="col-12 col-md-6">
              <wj-collection-view-pager [cv]="gridCollection">
              </wj-collection-view-pager>
            </div>
            <div class="col-12 col-md-6 text-right">
              <button class="btn btn-sm btn-outline-primary h-100" (click)="getGridData(showFinished)">🔄 Actualizar Lista </button>

              <div class="btn-group btn-group-toggle h-100">
                <label class="ml-2 btn btn-sm btn-outline-success" ngbButtonLabel>
                  <input type="checkbox" [(ngModel)]="showFinished" ngbButton>
                  <ng-container *ngIf="showFinished">✅</ng-container>
                  <ng-container *ngIf="!showFinished">❌</ng-container>
                  Ver Completados
                </label>
              </div>

            </div>
          </div>

        </ng-container>

      </div>
    </div>
  </div>
  <div class="col-4">
    <div class="card">
      <div class="card-body">
        <ng-container *ngIf="selectedRepairData">
          <div class="row no-gutters">
            <div class="col-5">
              <p class="mb-0"><strong>ID Reparación: </strong> {{ selectedRepairData.repairId }}</p>
            </div>
            <div class="col-7 text-right">
              <button class="btn btn-sm btn-primary" (click)="goToUpdate(selectedRepairData.repairId)"> 🛠️ Actualizar  </button>
              <button type="button" class="ml-3 btn btn-sm btn-danger" (click)="open(deleteModal)"> ❌ Eliminar </button>
            </div>
          </div>
          <hr>
          <p><strong>Cliente: </strong> {{ selectedRepairData.nombreApellidoCliente }}</p>
          <p><strong>eMail: </strong> {{ selectedRepairData.emailCliente }}</p>
          <p><strong>Teléfono: </strong> {{ selectedRepairData.telefonoCliente }}</p>
          <hr>
          <p><strong>Modelo: </strong> {{ selectedRepairData.modelo }}</p>
          <p><strong>Estado: </strong>{{ selectedRepairData.estado }}</p>
          <p><strong>IMEI: </strong>{{ selectedRepairData.imei }}</p>
          <p><strong>Encendido: </strong> <input type="checkbox" class="form-check-input" disabled [ngModel]="selectedRepairData.encendido"></p>
          <hr>
          <p><strong>Problema: </strong>{{ selectedRepairData.problema }}</p>
          <hr>
          <p><strong>Fecha de Ingreso: </strong>{{ selectedRepairData.fechaIngreso }}</p>
          <p><strong>Última Actualización: </strong>{{ selectedRepairData.fechaUltimaActualizacion }}</p>
          <p *ngIf="selectedRepairData.fechaReparacionTerminada"><strong>Fecha de Término: </strong>{{ selectedRepairData.fechaReparacionTerminada }}</p>
          <hr>
          <p><strong>Costo de Reparación: </strong>{{ selectedRepairData.costoReparacion }}</p>
          <p><strong>Precio de Reparación: </strong>{{ selectedRepairData.precioReparacion }}</p>
        </ng-container>
        <ng-container *ngIf="!selectedRepairData">
          <p>Seleccione una reparación de la grilla</p>
          <hr>
        </ng-container>
      </div>
    </div>
  </div>
</div>

<ng-template #deleteModal let-modal>
  <div class="modal-header">
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body text-center">
    <p><b>¿Está seguro de que desea borrar la reparación?</b></p>
    <p class="mb-0"><strong>ID Reparación: </strong> {{ selectedRepairData.repairId }}</p>
  </div>
  <div class="modal-footer">
    <button class="btn btn-sm btn-secondary" (click)="modal.close('Cancel')">⬅️️ Cancelar</button>
    <button class="ml-3 btn btn-sm btn-danger" (click)="delete(selectedRepairData.repairId)">❌ Eliminar</button>
  </div>
</ng-template>

<ng-template #updateModal let-modal>
  <div class="modal-header">
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body text-center">
    <p><b>¿Está seguro de que desea borrar la reparación?</b></p>
    <p class="mb-0"><strong>ID Reparación: </strong> {{ selectedRepairData.repairId }}</p>
  </div>
  <div class="modal-footer">
    <button class="btn btn-sm btn-secondary" (click)="modal.close('Cancel')">⬅️ Cancelar</button>
    <button class="ml-3 btn btn-sm btn-primary" (click)="update()">🛠 Actualizar</button>
  </div>
</ng-template>
