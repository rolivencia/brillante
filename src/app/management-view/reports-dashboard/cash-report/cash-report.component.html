<div class="card">
    <div class="card-header">
        <div class="row">
            <div class="col-3 col-xl-3 input-group input-group-sm">
                <div class="input-group-prepend">
                    <span class="input-group-text">Desde</span>
                </div>
                <input
                    class="form-control"
                    placeholder="yyyy-mm-dd"
                    name="from"
                    [disabled]="loading"
                    [minDate]="cashDashboardService.ngbSystemInitialDate"
                    [maxDate]="cashDashboardService.ngbMaxDate"
                    [displayMonths]="displayMonths"
                    [navigation]="navigation"
                    [outsideDays]="outsideDays"
                    [(ngModel)]="cashDashboardService.ngbDateFrom"
                    (click)="from.toggle()"
                    ngbDatepicker
                    #from="ngbDatepicker"
                />
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" (click)="from.toggle()" type="button">üìÖ</button>
                </div>
            </div>
            <div class="col-3 col-xl-3 input-group input-group-sm">
                <div class="input-group-prepend">
                    <span class="input-group-text">Hasta</span>
                </div>
                <input
                    class="form-control"
                    placeholder="yyyy-mm-dd"
                    name="to"
                    [disabled]="loading"
                    [minDate]="cashDashboardService.ngbDateFrom"
                    [maxDate]="cashDashboardService.ngbSystemMaxDate"
                    [displayMonths]="displayMonths"
                    [navigation]="navigation"
                    [outsideDays]="outsideDays"
                    [(ngModel)]="cashDashboardService.ngbDateTo"
                    (click)="to.toggle()"
                    ngbDatepicker
                    #to="ngbDatepicker"
                />
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" (click)="from.toggle()" type="button">üìÖ</button>
                </div>
            </div>

            <div class="col-6 text-right">
                <button
                    class="btn btn-sm btn-outline-dark"
                    (click)="refreshGrid(cashDashboardService.ngbDateFrom, cashDashboardService.ngbDateTo)"
                >
                    ‚úÖ Generar
                </button>
                <button
                    *ngIf="cashDashboardService.gridCollection.itemCount > 0"
                    class="ml-3 mr-3 btn btn-sm btn-outline-dark"
                    (click)="exportToXls()"
                >
                    üíæ Exportar
                </button>
                <button class="ml-5 btn btn-sm btn-outline-secondary" type="button" (click)="back()">‚¨ÖÔ∏è Volver</button>
            </div>
        </div>
    </div>
    <div id="cash-report" class="card-body">
        <div id="cash-transaction-report" class="card-body">
            <ng-container *ngIf="loading">
                <div class="alert alert-info">
                    <h3>Cargando...</h3>
                </div>
            </ng-container>
            <ng-container *ngIf="!loading">
                <div id="grid-container">
                    <div *ngIf="cashDashboardService.gridCollection.itemCount === 0" class="alert alert-info">
                        Seleccion√° las fechas a analizar y clicke√° en "Generar" para para visualizar el reporte.
                    </div>
                    <wj-flex-grid
                        #cashGrid
                        *ngIf="cashDashboardService.gridCollection.itemCount > 0"
                        [selectionMode]="'Row'"
                        [itemsSource]="cashDashboardService.gridCollection"
                        [headersVisibility]="'Column'"
                        [autoGenerateColumns]="false"
                        [allowResizing]="'Columns'"
                        [showSelectedHeaders]="'Row'"
                        [isReadOnly]="true"
                        (initialized)="cashDashboardService.initializeGrid(cashGrid)"
                    >
                        <wj-flex-grid-filter
                            [filterColumns]="[
                                'paymentMethod.description',
                                'officeBranch.name',
                                'audit.createdBy.userName'
                            ]"
                            [showSortButtons]="false"
                        ></wj-flex-grid-filter>
                        <wj-flex-grid-column
                            *ngFor="let column of columns"
                            [width]="column.width"
                            [binding]="column.binding"
                            [header]="column.header"
                            [visible]="true"
                            [aggregate]="
                                column.header === 'Ingreso' || column.header === 'Egreso' || column.header === 'Saldo'
                                    ? 'Sum'
                                    : 'None'
                            "
                        >
                            <ng-template
                                *ngIf="column.header === 'Ingreso'"
                                wjFlexGridCellTemplate
                                [cellType]="'Cell'"
                                let-cell="cell"
                            >
                                <ng-container *ngIf="cell.item.concept.transactionType.id === 1">
                                    <div class="d-flex justify-content-between">
                                        <div>$</div>
                                        <div>{{ cashDashboardService.decimalSeparatorParser(cell.item.income) }}</div>
                                    </div>
                                </ng-container>
                            </ng-template>

                            <ng-template
                                *ngIf="column.header === 'Ingreso'"
                                wjFlexGridCellTemplate
                                [cellType]="'ColumnFooter'"
                                let-cell="cell"
                            >
                                <div class="alert alert-success mb-0 p-1 border-0 d-flex justify-content-between">
                                    <div>$</div>
                                    <div>{{ cashDashboardService.decimalSeparatorParser(cell.value) }}</div>
                                </div>
                            </ng-template>

                            <ng-template
                                *ngIf="column.header === 'Egreso'"
                                wjFlexGridCellTemplate
                                [cellType]="'Cell'"
                                let-cell="cell"
                            >
                                <ng-container *ngIf="cell.item.concept.transactionType.id === 0">
                                    <div class="d-flex justify-content-between">
                                        <div>$</div>
                                        <div>{{ cashDashboardService.decimalSeparatorParser(cell.item.expense) }}</div>
                                    </div>
                                </ng-container>
                            </ng-template>

                            <ng-template
                                *ngIf="column.header === 'Egreso'"
                                wjFlexGridCellTemplate
                                [cellType]="'ColumnFooter'"
                                let-cell="cell"
                            >
                                <div class="alert alert-danger mb-0 p-1 border-0 d-flex justify-content-between">
                                    <div>$</div>
                                    <div>{{ cashDashboardService.decimalSeparatorParser(cell.value) }}</div>
                                </div>
                            </ng-template>

                            <ng-template
                                *ngIf="column.header === 'Saldo'"
                                wjFlexGridCellTemplate
                                [cellType]="'Cell'"
                                let-cell="cell"
                            >
                                <div class="d-flex justify-content-between">
                                    <div>$</div>
                                    <div>{{ cashDashboardService.decimalSeparatorParser(cell.item.amount) }}</div>
                                </div>
                            </ng-template>

                            <ng-template
                                *ngIf="column.header === 'Saldo'"
                                wjFlexGridCellTemplate
                                [cellType]="'ColumnFooter'"
                                let-cell="cell"
                            >
                                <div class="alert alert-info mb-0 p-1 border-0 d-flex justify-content-between">
                                    <div>$</div>
                                    <div>{{ cashDashboardService.decimalSeparatorParser(cell.value) }}</div>
                                </div>
                            </ng-template>

                            <ng-template
                                *ngIf="column.header === 'Fecha y Hora'"
                                wjFlexGridCellTemplate
                                [cellType]="'Cell'"
                                let-cell="cell"
                            >
                                <div class="text-right">{{ cell.item.date.format('YYYY-MM-DD HH:mm') }}</div>
                            </ng-template>
                        </wj-flex-grid-column>
                    </wj-flex-grid>
                </div>
            </ng-container>
        </div>
    </div>
</div>
