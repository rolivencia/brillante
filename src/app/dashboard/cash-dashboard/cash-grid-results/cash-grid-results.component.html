<div class="card">
    <div class="card-header">
        <div class="row">
            <div class="col-12 d-flex">
                <button class="btn btn-sm btn-outline-secondary mr-3" (click)="generateReport()">ðŸ“Š Generar Reporte</button>
                <button class="btn btn-sm btn-outline-secondary mr-3" (click)="setTodayDate()">ðŸ“… Ver caja de Hoy</button>

                <div class="input-group input-group-sm">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Fecha</span>
                    </div>
                    <input
                        class="form-control"
                        placeholder="yyyy-mm-dd"
                        name="from"
                        [disabled]="cashDashboardService.loading"
                        [maxDate]="cashDashboardService.ngbMaxDate"
                        [displayMonths]="displayMonths"
                        [navigation]="navigation"
                        [outsideDays]="outsideDays"
                        [(ngModel)]="cashDashboardService.ngbDate"
                        (ngModelChange)="refreshGrid(cashDashboardService.ngbDate)"
                        (click)="from.toggle()"
                        ngbDatepicker
                        #from="ngbDatepicker"
                    />
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" (click)="from.toggle()" type="button">
                            ðŸ“…
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="cash-transaction-grid" class="card-body">
        <ng-container *ngIf="cashDashboardService.loading">
            <div class="alert alert-info">
                <h3>Cargando...</h3>
            </div>
        </ng-container>
        <ng-container *ngIf="!cashDashboardService.loading">
            <div *ngIf="editMode && cashDashboardService.gridCollection.itemCount > 0" class="alert alert-info">
                PresionÃ¡ en "Volver" arriba en el menÃº derecho para desactivar el <b>modo ediciÃ³n</b> y poder seleccionar transacciones de
                la grilla.
            </div>
            <div *ngIf="cashDashboardService.gridCollection.itemCount === 0" class="alert alert-info">
                No hay transacciones registradas para esta fecha.
                <ng-container *ngIf="cashDashboardService.isToday()"
                    >RecordÃ¡ que tenÃ©s que <b>abrir caja</b> para poder crear nuevas transacciones para el dÃ­a de hoy y
                    visualizarlas.</ng-container
                >
            </div>
            <wj-flex-grid
                #cashGrid
                *ngIf="cashDashboardService.gridCollection.itemCount > 0"
                [selectionMode]="editMode ? 'None' : 'Row'"
                [itemsSource]="cashDashboardService.gridCollection"
                [headersVisibility]="'Column'"
                [autoGenerateColumns]="false"
                [allowResizing]="'Columns'"
                [showSelectedHeaders]="'Row'"
                [isReadOnly]="true"
                (initialized)="initializeGrid(cashGrid)"
                (selectionChanged)="getRegisterDetails(cashDashboardService.gridCollection.currentItem)"
            >
                <wj-flex-grid-column
                    *ngFor="let column of columns"
                    [width]="column.width"
                    [binding]="column.binding"
                    [header]="column.header"
                    [visible]="true"
                    [aggregate]="column.header === 'Ingreso' || column.header === 'Egreso' || column.header === 'Saldo' ? 'Sum' : 'None'"
                >
                    <ng-template *ngIf="column.header === 'Ingreso'" wjFlexGridCellTemplate [cellType]="'Cell'" let-cell="cell">
                        <ng-container *ngIf="cell.item.concept.transactionType.id === 1">
                            <div class="d-flex justify-content-between">
                                <div>$</div>
                                <div>{{ cell.item.income }}</div>
                            </div>
                        </ng-container>
                    </ng-template>

                    <ng-template *ngIf="column.header === 'Ingreso'" wjFlexGridCellTemplate [cellType]="'ColumnFooter'" let-cell="cell">
                        <div class="alert alert-success mb-0 p-1 border-0 d-flex justify-content-between">
                            <div>$</div>
                            <div>{{ cell.value }}</div>
                        </div>
                    </ng-template>

                    <ng-template *ngIf="column.header === 'Egreso'" wjFlexGridCellTemplate [cellType]="'Cell'" let-cell="cell">
                        <ng-container *ngIf="cell.item.concept.transactionType.id === 0">
                            <div class="d-flex justify-content-between">
                                <div>$</div>
                                <div>{{ cell.item.expense }}</div>
                            </div>
                        </ng-container>
                    </ng-template>

                    <ng-template *ngIf="column.header === 'Egreso'" wjFlexGridCellTemplate [cellType]="'ColumnFooter'" let-cell="cell">
                        <div class="alert alert-danger mb-0 p-1 border-0 d-flex justify-content-between">
                            <div>$</div>
                            <div>{{ cell.value }}</div>
                        </div>
                    </ng-template>

                    <ng-template *ngIf="column.header === 'Saldo'" wjFlexGridCellTemplate [cellType]="'Cell'" let-cell="cell">
                        <div class="d-flex justify-content-between">
                            <div>$</div>
                            <div>{{ cell.item.amount }}</div>
                        </div>
                    </ng-template>

                    <ng-template *ngIf="column.header === 'Saldo'" wjFlexGridCellTemplate [cellType]="'ColumnFooter'" let-cell="cell">
                        <div class="alert alert-info mb-0 p-1 border-0 d-flex justify-content-between">
                            <div>$</div>
                            <div>{{ cell.value }}</div>
                        </div>
                    </ng-template>

                    <ng-template *ngIf="column.header === 'Hora'" wjFlexGridCellTemplate [cellType]="'Cell'" let-cell="cell">
                        <div class="text-right">{{ cell.item.date.format('HH:mm') }}</div>
                    </ng-template>
                </wj-flex-grid-column>
            </wj-flex-grid>
        </ng-container>
    </div>
</div>
